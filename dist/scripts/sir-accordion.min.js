"use strict";angular.module("sir-accordion",[]).directive("sirNgAccordion",["$compile","$timeout",function(e,o){var n="";return{restrict:"A",scope:{collection:"=",config:"=?"},template:n,controller:["$scope",function(e){e.config={debug:"undefined"!=typeof e.config.debug?e.config.debug:!1,animDur:e.config.animDur>=200&&document.body.firstElementChild?e.config.animDur:0,expandFirst:"undefined"!=typeof e.config.expandFirst?e.config.expandFirst:!1,autoCollapse:"undefined"!=typeof e.config.autoCollapse?e.config.autoCollapse:!0,watchInternalChanges:"undefined"!=typeof e.config.watchInternalChanges?e.config.watchInternalChanges:!1,headerClass:e.config.headerClass||"",preHeader:e.config.preHeader||'<div class="sir-accordion-vertical-align"><div>',postHeader:e.config.postHeader||"</div></div>",topContentClass:e.config.topContentClass||"",preTopContent:e.config.preTopContent||"",postTopContent:e.config.postTopContent||"",bottomContentClass:e.config.bottomContentClass||"",preBottomContent:e.config.preBottomContent||"",postBottomContent:e.config.postBottomContent||""}}],link:function(n,i){var t=n.config.animDur,a="",d="",s="",c="",l="",r="",f=[],g=[],h=[],u="0",p="background: #0044CE; color: #fff";n.$watch("collection",function(){return angular.isArray(n.collection)?(a="",d="",s="",c="",l="",r="",f=[],g=[],h=[],u="0",r=C(n.collection,0,0,0),e(r)(n,function(e){i.html(""),i.append(e)}),void v()):void i.html("No collection found")},n.config.watchInternalChanges);var v=function(){for(var e=null,o=null,n=null,i=g.length-1;i>=0;i--)e=document.getElementById("sac"+g[i]),o=e.firstElementChild?e.firstElementChild:e.firstChild,n=o.nextSibling,g[i]={id:e.id,obj:n},f[i]={id:e.id,obj:o},e.firstElementChild&&(g[i].obj.firstElementChild.style.transition="all "+(t-100)+"ms",f[i].obj.style.transition="all "+t+"ms")},C=function(e,o,i,t){return i==e.length?"":(l=t?String(o)+"-"+String(i+1):String(i+1),a=n.config.preHeader+e[i].title+n.config.postHeader,d=b(n.config.preTopContent,e[i].topContent,n.config.postTopContent),g.push(l),c=0==i?0==t?'<div class="sir-accordion-wrapper"> <div id="sac'+l+'" > <div class="sir-accordion-header '+n.config.headerClass+'" ng-click= "expandCollapse(\''+l+'\')" class="'+n.config.headerClass+'">'+a+'</div><div class="sir-accordion-content"> <div><div class="'+n.config.topContentClass+'">'+d+"</div>":'<div class="sir-accordion-group"> <div id="sac'+l+'" > <div class="sir-accordion-header '+n.config.headerClass+'" ng-click="expandCollapse(\''+l+'\')" class="'+n.config.headerClass+'">'+a+'</div><div class="sir-accordion-content"> <div><div class="'+n.config.topContentClass+'">'+d+"</div>":'<div id="sac'+l+'" > <div class="sir-accordion-header '+n.config.headerClass+'" ng-click="expandCollapse(\''+l+'\')" class="'+n.config.headerClass+'">'+a+'</div><div class="sir-accordion-content"> <div><div class="'+n.config.topContentClass+'">'+d+"</div>",angular.isArray(e[i].subCollection)&&e[i].subCollection.length?(c+=C(e[i].subCollection,l,0,t+1),s=b(n.config.preBottomContent,e[i].bottomContent,n.config.postBottomContent),c=c+'</div><div class="'+n.config.bottomContentClass+'">'+s+"</div></div></div></div>"):(s=b(n.config.preBottomContent,e[i].bottomContent,n.config.postBottomContent),c=c+'</div><div class="'+n.config.bottomContentClass+'">'+s+"</div></div></div>"),c+C(e,o,i+1,t))},b=function(e,o,n){return o=o?e+o+n:""},m=function(e,o){n.config.debug&&console.log("Chain collapsing");do{for(var i=g.length-1;i>=0;i--)n.config.autoCollapse&&g[i].id=="sac"+e?(y(g[i],"expanded"),y(f[i],"active-header")):x(g[i].id)==x(e)&&g[i].obj.className.indexOf("expanded")>-1&&(y(g[i],"expanded"),y(f[i],"active-header"));e=x(e)}while(j(e)!=j(o))},j=function(e){return"0"==e?0:e.split("-").length},x=function(e){if(-1==e.indexOf("-"))return"0";var o="";do o=e.substr(e.length-1),e=e.slice(0,-1);while("-"!=o);return e=e.replace("sac","")},y=function(e,o){if(e.obj.className.indexOf(o)>-1)return e.obj.className=e.obj.className.replace(o,""),n.config.debug&&console.log("removing class "+e.id),"expanded"==o&&w(e,0),!1;if(e.obj.className=N(e.obj.className)+" "+o,n.config.debug&&console.log("adding class "+e.id),"expanded"==o){var i=e.obj.firstChild.offsetHeight||e.obj.firstElementChild.offsetHeight;w(e,i)}return!0},H=function(e,o){do{if(x(o)==e)return!0;o=x(o)}while(j(o)>j(e));return!1},N=function(e){for(var e=e.replace(/^\s\s*/,""),o=/\s/,n=e.length;o.test(e.charAt(--n)););return e.slice(0,n+1)},O=function(e){return h.length?!0:!1},E=function(e){return e.style.height.substr(0,e.style.height.length-2)},w=function(e,i){h.push(e.id),o(function(){h=[],e.obj.style.transition="height 0s","0px"!=e.obj.style.height&&(e.obj.style.height="auto"),n.config.autoCollapse||F()},t),e.obj.style.transition="height "+t+"ms",o(function(){e.obj.style.height=i+"px"},40)},B=function(e){for(var o=g.length-1;o>=0;o--)if(g[o].id=="sac"+e||g[o].id==e)return o;return-1},A=function(){for(var e=g.length-1;e>=0;e--)if("auto"==g[e].obj.style.height){var o=g[e].obj.firstChild.offsetHeight||g[e].obj.firstElementChild.offsetHeight;g[e].obj.style.height=o+"px"}},F=function(){for(var e=g.length-1;e>=0;e--)if("0px"!=g[e].obj.style.height&&g[e].obj.style.height){{g[e].obj.firstChild.offsetHeight||g[e].obj.firstElementChild.offsetHeight}g[e].obj.style.height="auto"}},T=function(e,o){for(var n=e.length-1;n>=0;n--)H(o,e[n].id)&&e[n].obj.className.indexOf("expanded")>-1&&(y(e[n],"expanded"),y(f[n],"active-header"))};n.expandCollapse=function(e){var o=B(e),i=B(u),t=g[o],a=f[o],d=t.obj.firstChild.offsetHeight||t.obj.firstElementChild.offsetHeight;if(!t.id||!O(t.id)){if(A(),!n.config.autoCollapse){t.obj.className.indexOf("expanded")>-1&&T(g,e);var s=y(t,"expanded");for(y(a,"active-header");j(t.id)>=2;)t=g[B(x(t.id))],s?w(t,t.obj.offsetHeight+d):w(t,t.obj.offsetHeight-d);return void(u=e)}if("0"==u)return y(a,"active-header"),y(t,"expanded"),u=e,n.config.debug&&console.log("%c Opening First",p),void(n.config.debug&&console.log("From 0 to "+u));if(u==e){for(y(t,"expanded"),y(a,"active-header"),u=x(e)||"0";j(t.id)>=2;)t=g[B(x(t.id))],w(t,t.obj.offsetHeight-d);return n.config.debug&&console.log("%c Closing same",p),void(n.config.debug&&console.log("From current element to "+u))}if(u!=e&&!h.length){if(x(e)==u){for(n.config.debug&&console.log("%c Opening Child",p),y(t,"expanded"),y(a,"active-header"),u=e;j(t.id)>=2;)t=g[B(x(t.id))],w(t,t.obj.offsetHeight+d);return}if(H(e,u)){for(n.config.debug&&console.log("%c Closing Parent",p),m(u,e),y(t,"expanded"),y(a,"active-header"),u=x(e);j(t.id)>=2;)t=g[B(x(t.id))],w(t,t.obj.offsetHeight-d);return}if(x(u)==x(e)){n.config.debug&&console.log("%c Opening sibling",p);var c=E(g[i].obj);for(y(g[i],"expanded"),y(f[i],"active-header"),y(a,"active-header"),y(t,"expanded"),u=e;j(t.id)>=2;)t=g[B(x(t.id))],w(t,t.obj.offsetHeight+d-c);return}if(n.config.debug&&console.log("%c Opening other",p),j(e)>=2){for(var l=g[B(x(u))],r=g[B(x(t.id))];j(l.id)>j(e);)l=g[B(x(l.id))];for(;r&&j(r.id)>=1;)w(r,r.obj.offsetHeight+d-l.obj.offsetHeight),r=g[B(x(r.id))]}return m(u,x(e)),y(a,"active-header"),u=e,void y(t,"expanded")}}},n.$on("collapseAll",function(e){if(A(),!n.config.autoCollapse)for(var o=g.length-1;o>=0;o--)g[o].obj.className.indexOf("expanded")>-1&&(y(f[o],"active-header"),y(g[o],"expanded"));e.defaultPrevented=!0}),n.$on("expandAll",function(e){if(!n.config.autoCollapse){t=0;for(var o=g.length-1;o>=0;o--)-1==g[o].obj.className.indexOf("expanded")&&j(g[o].id)>1&&(y(f[o],"active-header"),y(g[o],"expanded"),g[o].obj.style.height="auto");t=n.config.animDur;for(var o=g.length-1;o>=0;o--)-1==g[o].obj.className.indexOf("expanded")&&1==j(g[o].id)&&(y(f[o],"active-header"),y(g[o],"expanded"))}e.defaultPrevented=!0})}}}]);