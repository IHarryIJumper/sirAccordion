"use strict";angular.module("sir-accordion",[]).directive("sirNgAccordion",["$compile","$timeout",function(e,t){var n="";return{restrict:"A",scope:{collection:"=",config:"=?"},template:n,controller:("sirNgAccordionCtrl",["$scope",function(e){e.config.headerClass=e.config.headerClass||"";e.config.preHeader=e.config.preHeader||'<div class="sir-accordion-vertical-align"><div>';e.config.postHeader=e.config.postHeader||"</div></div>";e.config.topContentClass=e.config.topContentclass||"";e.config.preTopContent=e.config.preTopContent||"";e.config.postTopContent=e.config.postTopContent||"";e.config.bottomContentClass=e.config.bottomContentclass||"";e.config.preBottomContent=e.config.preBottomContent||"";e.config.postBottomContent=e.config.postBottomContent||""}]),link:function(n,r){var i="";var s="";var o="";var u="";var a="";var f="";var l=[];var c=[];var h="0";var p=[];var d="background: #0044CE; color: #fff";n.$watch("collection",function(){if(!angular.isArray(n.collection)){r.html("No collection found");return}i="";s="";o="";u="";a="";f="";l=[];h="0";c=[];p=[];f=m(n.collection,0,0,0);e(f)(n,function(e,t){r.html("");r.append(e)});v()});var v=function(){for(var e=l.length-1;e>=0;e--){l[e]=document.getElementById("sac"+l[e])}};var m=function(e,t,r,f){if(r==e.length){return""}a=f?String(t)+"-"+String(r+1):String(r+1);i=n.config.preHeader+e[r].title+n.config.postHeader;s=g(n.config.preTopContent,e[r].topContent,n.config.postTopContent);l.push(a);if(r==0){if(f==0)u='<div class="sir-accordion-wrapper"> <div class="sir-accordion-header '+n.config.headerClass+'" ng-click="expandCollapse($event,\''+a+'\')" class="'+n.config.headerClass+'">'+i+"</div>"+'<div id="sac'+a+'" class="sir-accordion-content '+n.config.topContentClass+'"> <div>'+s;else u='<div class="sir-accordion-group"> <div class="sir-accordion-header '+n.config.headerClass+'" ng-click="expandCollapse($event,\''+a+'\')" class="'+n.config.headerClass+'">'+i+"</div>"+'<div id="sac'+a+'" class="sir-accordion-content '+n.config.topContentClass+'"> <div>'+s}else{u='<div class="sir-accordion-header '+n.config.headerClass+'" ng-click="expandCollapse($event,\''+a+'\')" class="'+n.config.headerClass+'">'+i+"</div>"+'<div id="sac'+a+'" class="sir-accordion-content '+n.config.topContentClass+'"> <div>'+s}if(angular.isArray(e[r].subCollection)&&e[r].subCollection.length){u=u+m(e[r].subCollection,a,0,f+1);o=g(n.config.preBottomContent,e[r].bottomContent,n.config.postBottomContent);u=u+o+"</div></div></div>"}else{o=g(n.config.preBottomContent,e[r].bottomContent,n.config.postBottomContent);u=u+o+'<div class="sir-accordion-content-margin"></div></div></div>'}return u+m(e,t,r+1,f)};var g=function(e,t,n){if(!t){t=""}else{t=e+t+n}return t};var y=function(e,t){if(n.config.debug)console.log("Chain collapsing");do{for(var r=l.length-1;r>=0;r--){if(l[r].id=="sac"+e){E(l[r],"expanded")}}e=w(e);E(p[p.length-1],"active-header");p.pop()}while(b(e)!=b(t))};var b=function(e){if(e=="0")return 0;else return e.split("-").length};var w=function(e){if(e.indexOf("-")==-1){return"0"}var t="";do{t=e.substr(e.length-1);e=e.slice(0,-1)}while(t!="-");return e};var E=function(e,t){if(e.className.indexOf(t)>-1){e.className=e.className.replace(t,"");if(n.config.debug)console.log("removing class "+e.id);if(t=="expanded"){N(e,0)}return}else{e.className=x(e.className)+" "+t;if(n.config.debug)console.log("adding class "+e.id);if(t=="expanded"){var r=e.firstChild.offsetHeight||e.firstElementChild.offsetHeight;N(e,r)}return}};var S=function(e,t){var n=false;do{if(w(t)==e)n=true;t=w(t)}while(b(t)>b(e));return n};var x=function(e){var e=e.replace(/^\s\s*/,""),t=/\s/,n=e.length;while(t.test(e.charAt(--n)));return e.slice(0,n+1)};var T=function(e){for(var t=c.length-1;t>=0;t--){if(c[t]==e){return true}}return false};var N=function(e,n){c.push(e.id);t(function(){c=[];if(e.style.height!="0px"){e.style.height="auto"}},400);t(function(){e.style.height=n+"px"},1)};var C=function(e){for(var t=l.length-1;t>=0;t--){if(l[t].id=="sac"+e||l[t].id==e)return t}return-1};var k=function(e){while(e.className.indexOf("sir-accordion-header")==-1){e=e.parentElement}return e};var L=function(){for(var e=l.length-1;e>=0;e--){if(l[e].style.height=="auto"){var t=l[e].firstChild.offsetHeight||l[e].firstElementChild.offsetHeight;l[e].style.height=t+"px"}}};n.expandCollapse=function(e,t){var r=e.currentTarget?e.currentTarget:k(e.srcElement);var i=C(t);var s=C(h);var o=l[i];var u=o;var a=l[C(w(o.id))];var f=o.firstChild.offsetHeight||o.firstElementChild.offsetHeight;if(o.id&&T(o.id))return;L();var v="-1";if(h=="0"){E(r,"active-header");E(l[i],"expanded");h=t;p.push(r);if(n.config.debug)console.log("%c Opening First",d);if(n.config.debug)console.log("From 0 to "+h);return}if(h==t){E(l[i],"expanded");E(r,"active-header");h=w(t)||"0";p.pop();while(b(u.id)>=2){N(a,a.offsetHeight-f);u=a;a=l[C(w(u.id))]}if(n.config.debug)console.log("%c Closing same",d);if(n.config.debug)console.log("From current element to "+h);return}if(h!=t&&!c.length){var m="";var g=l[s].style.height;g=g.substr(0,g.length-2);if(w(t)==h){if(n.config.debug)console.log("%c Opening Child",d);E(l[i],"expanded");E(r,"active-header");p.push(r);h=t;while(b(u.id)>=2){N(a,a.offsetHeight+f);u=a;a=l[C(w(u.id))]}return}else if(S(t,h)){if(n.config.debug)console.log("%c Closing Parent",d);y(h,t);E(l[i],"expanded");E(r,"active-header");p.pop();h=w(t);while(b(u.id)>=2){N(a,a.offsetHeight-f);u=a;a=l[C(w(u.id))]}return}else if(w(h)==w(t)){if(n.config.debug)console.log("%c Opening sibling",d);E(l[s],"expanded");E(p[p.length-1],"active-header");p.pop();p.push(r);E(r,"active-header");E(l[i],"expanded");h=t;while(b(u.id)>=2){N(a,a.offsetHeight+f-g);u=a;a=l[C(w(u.id))]}return}else{if(n.config.debug)console.log("%c Opening other",d);if(b(t)>=2){var x=w(h);x=C(x);x=l[x];while(b(x.id)>b(t)){x=l[C(w(x.id))]}x=f-x.offsetHeight;var A=a;while(A&&b(A.id)>=1){N(A,A.offsetHeight+x);A=l[C(w(A.id))]}}y(h,w(t));E(r,"active-header");p.push(r);h=t;E(l[i],"expanded");return}return false}}}}}])